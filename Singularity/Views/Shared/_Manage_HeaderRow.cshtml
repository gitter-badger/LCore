@* Generator: MvcView *@

@using LCore;
@using Singularity;
@using Singularity.Models;
@using Singularity.Controllers;
@using Singularity.Context;
@using Singularity.Routes;
@using Singularity.Extensions;
@using Singularity.Annotations;

@using System.Linq;
@using System.Linq.Expressions;
@using System.Collections;
@using System.Collections.Generic;
@using System.ComponentModel;
@using System.ComponentModel.DataAnnotations;
@using System.ComponentModel.DataAnnotations.Schema;
@using System.ComponentModel.Design;
@using System.Web;
@using System.Web.Mvc;

@model ManageViewModel

@{
    IEnumerable<ModelMetadata> Fields = null;

    if (Model.ModelType.HasInterface<IFieldGroups>())
        {
        Fields = (Model.ModelType.New() as IFieldGroups).GetFieldGroup(Context, ControllerHelper.ViewType.TableCell);
        }
    else
        {
        Fields = FieldGroups.GetFieldGroup(Context, Model.ModelType, ControllerHelper.ViewType.TableCell);
        }
}

<thead>
    <tr>
        @if (ViewContext.AllowView(Model.ModelType))
            {
            <td class="view-cell center">
                <div>
                    @Html.TextContent("Manage_ColumnHeader_" + Model.ModelType.GetFriendlyTypeName() + "_View", "View")
                </div>
            </td>
            }

        @foreach (ModelMetadata Meta in Fields)
            {
            String ColumnTitle = Meta.DisplayName ?? Meta.PropertyName.Humanize();
            String ColumnClass = Meta.PropertyName.ToUrlSlug();

            <td class="@(Model.OverrideSort == Meta.PropertyName ? "sort-column" : "") @ColumnClass">
                @*
    @if (false && Meta.ModelType.HasInterface<IModel>())
        {
        // No sorting relational fields for now.

        @Html.TextContent("Manage_ColumnHeader_" + Model.ModelType.GetFriendlyTypeName() + "_" + ColumnTitle, ColumnTitle)
        }
    else
                *@
                @if (Meta.HasAttribute<NotMappedAttribute>())
                    {
                    // No DB column: no sorting

                    @Html.TextContent("Manage_ColumnHeader_" + Model.ModelType.GetFriendlyTypeName() + "_" + ColumnTitle, ColumnTitle)
                    }
                else if (Meta.PropertyName.Contains("."))
                    {
                    foreach (String s in Meta.PropertyName.Split("."))
                        {
                        @s.Humanize()
                        @(new HtmlString("&nbsp;"))
                        }
                    }
                else
                    {
                    <a href="@(Url.Controller<ManageController>()
                        .QS(Singularity.Routes.Controllers.Manage.Actions.Route_SortColumn(Model, Meta.PropertyName))
                        .Lambda<int,String,SortDirection,String ,String , ControllerHelper.ManageViewType , String , Boolean>(c=> c.Manage))">

                        @Html.TextContent("Manage_ColumnHeader_" + Model.ModelType.GetFriendlyTypeName() + "_" + ColumnTitle, ColumnTitle)

                        @if (Model.OverrideSort == Meta.PropertyName)
                            {
                            if (Model.OverrideSortDirection == SortDirection.Ascending)
                                {
                                <span class="glyphicons glyphicons-up-arrow">&#xe093;</span>
                                }
                            else
                                {
                                <span class="glyphicons glyphicons-down-arrow">&#xe094;</span>
                                }
                            }
                    </a>
                    }
            </td>
            }

        @if (ViewContext.AllowEdit(Model.ModelType))
            {
            <td class="edit-cell">
                <div>
                    @Html.TextContent("Manage_ColumnHeader_" + Model.ModelType.GetFriendlyTypeName() + "_Edit", "Edit")
                </div>
            </td>
            }

        @if (ViewContext.AllowDeactivate(Model.ModelType))
            {
            <td class="deactivate-cell">
                <div>
                    @{
            String DeleteResotreStr = Model.ViewType.HasFlag(ControllerHelper.ManageViewType.Inactive) ? "Restore" : "Delete";
                    }
                    @Html.TextContent("Manage_ColumnHeader_" + Model.ModelType.GetFriendlyTypeName() + "_" + DeleteResotreStr, DeleteResotreStr)
                </div>
            </td>
            }
    </tr>
</thead>